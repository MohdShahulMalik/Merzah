{"schemas":"-- Graph edge: user administers/handles a mosque\nDEFINE TABLE IF NOT EXISTS handles SCHEMAFULL TYPE RELATION IN users OUT mosques;\n\n-- When was this permission granted\nDEFINE FIELD IF NOT EXISTS granted_at ON handles TYPE datetime DEFAULT time::now();\n\n-- Who granted it (optional audit trail)\nDEFINE FIELD IF NOT EXISTS granted_by ON handles TYPE record<users> ASSERT $value != NONE;\n\n-- Prevent duplicate edges\nDEFINE INDEX IF NOT EXISTS idx_handles_unique ON handles FIELDS in, out UNIQUE;\n\nDEFINE TABLE IF NOT EXISTS mosques SCHEMAFULL;\n\nDEFINE FIELD IF NOT EXISTS name ON mosques TYPE option<string>;\nDEFINE FIELD IF NOT EXISTS location ON mosques TYPE geometry<point>;\nDEFINE FIELD IF NOT EXISTS street ON mosques TYPE option<string>;\nDEFINE FIELD IF NOT EXISTS city ON mosques TYPE option<string>;\n\nDEFINE FIELD IF NOT EXISTS adhan_times ON mosques TYPE option<object>;\nDEFINE FIELD IF NOT EXISTS adhan_times.fajr ON mosques TYPE string;\nDEFINE FIELD IF NOT EXISTS adhan_times.dhuhr ON mosques TYPE string;\nDEFINE FIELD IF NOT EXISTS adhan_times.asr ON mosques TYPE string;\nDEFINE FIELD IF NOT EXISTS adhan_times.maghrib ON mosques TYPE string;\nDEFINE FIELD IF NOT EXISTS adhan_times.isha ON mosques TYPE string;\nDEFINE FIELD IF NOT EXISTS adhan_times.jummah ON mosques TYPE string;\n\nDEFINE FIELD IF NOT EXISTS jamat_times ON mosques TYPE option<object>;\nDEFINE FIELD IF NOT EXISTS jamat_times.fajr ON mosques TYPE string;\nDEFINE FIELD IF NOT EXISTS jamat_times.dhuhr ON mosques TYPE string;\nDEFINE FIELD IF NOT EXISTS jamat_times.asr ON mosques TYPE string;\nDEFINE FIELD IF NOT EXISTS jamat_times.maghrib ON mosques TYPE string;\nDEFINE FIELD IF NOT EXISTS jamat_times.isha ON mosques TYPE string;\nDEFINE FIELD IF NOT EXISTS jamat_times.jummah ON mosques TYPE string;\n\nDEFINE FIELD IF NOT EXISTS created_at ON mosques TYPE datetime DEFAULT time::now();\nDEFINE FIELD IF NOT EXISTS updated_at ON mosques TYPE datetime DEFAULT time::now();\n\nDEFINE INDEX IF NOT EXISTS mosque_location_idx ON TABLE mosques COLUMNS location;\nDEFINE INDEX IF NOT EXISTS idx_mosque_name ON TABLE mosques COLUMNS name;\nDEFINE INDEX IF NOT EXISTS idx_mosque_city ON TABLE mosques COLUMNS city;\n\nDEFINE TABLE OVERWRITE script_migration SCHEMAFULL\n    PERMISSIONS\n        FOR select FULL\n        FOR create, update, delete NONE;\n\nDEFINE FIELD OVERWRITE script_name ON script_migration TYPE string;\nDEFINE FIELD OVERWRITE executed_at ON script_migration TYPE datetime VALUE time::now() READONLY;\nDEFINE FIELD OVERWRITE checksum ON script_migration TYPE option<string>;\n\nDEFINE TABLE IF NOT EXISTS sessions SCHEMAFULL;\n\nDEFINE FIELD IF NOT EXISTS user ON sessions TYPE record<users> ASSERT $value != NONE;\nDEFINE FIELD IF NOT EXISTS session_token ON sessions TYPE string;\nDEFINE FIELD IF NOT EXISTS created_at ON sessions TYPE datetime DEFAULT time::now();\nDEFINE FIELD IF NOT EXISTS expires_at ON sessions TYPE datetime;\n\n-- Unique Session Tokens\nDEFINE INDEX IF NOT EXISTS idx_session_token ON TABLE sessions COLUMNS session_token UNIQUE;\n\nDEFINE TABLE IF NOT EXISTS user_identifier SCHEMAFULL;\n\nDEFINE FIELD IF NOT EXISTS user ON user_identifier TYPE record<users> ASSERT $value != NONE;\nDEFINE FIELD IF NOT EXISTS identifier_type ON user_identifier TYPE string ASSERT $value IN ['email', 'mobile'];\nDEFINE FIELD IF NOT EXISTS identifier_value ON user_identifier TYPE string;\nDEFINE FIELD IF NOT EXISTS created_at ON user_identifier TYPE datetime DEFAULT time::now();\nDEFINE FIELD IF NOT EXISTS updated_at ON user_identifier TYPE datetime DEFAULT time::now();\n\n-- Allow only one user per identifier_value globally\nDEFINE INDEX IF NOT EXISTS idx_identifier_value ON TABLE user_identifier COLUMNS identifier_value UNIQUE;\n\n-- Only one identifier of each type per user\nDEFINE INDEX IF NOT EXISTS idx_user_identifier_type ON TABLE user_identifier COLUMNS user, identifier_type UNIQUE;\n\nDEFINE TABLE IF NOT EXISTS users SCHEMAFULL;\n\nDEFINE FIELD IF NOT EXISTS password_hash ON users TYPE string\n\tASSERT string::len($value) > 0;\nDEFINE FIELD IF NOT EXISTS role ON users TYPE string\n\tASSERT $value IN ['app_admin', 'mosque_supervisor', 'education_supervisor','educator', 'regular']\n\tDEFAULT 'regular';\nDEFINE FIELD IF NOT EXISTS display_name ON users TYPE string;\nDEFINE FIELD IF NOT EXISTS created_at ON users TYPE datetime DEFAULT time::now();\nDEFINE FIELD IF NOT EXISTS updated_at ON users TYPE datetime DEFAULT time::now();\n","events":"DEFINE EVENT IF NOT EXISTS cleanup_expired_session ON TABLE sessions WHEN $before != NONE THEN (\n\tDELETE sessions WHERE expires_at <= time::now()\n);\n"}